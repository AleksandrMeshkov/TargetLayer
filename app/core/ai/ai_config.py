import os
from typing import Dict, Any

OLLAMA_BASE_URL = os.getenv("OLLAMA_BASE_URL", "http://localhost:11434")
OLLAMA_TIMEOUT = int(os.getenv("OLLAMA_TIMEOUT", "30"))
AI_MODEL_NAME = os.getenv("AI_MODEL", "qwen2.5:3b")

MAX_RETRIES = 3
RETRY_DELAY = 1  

def validate_config() -> Dict[str, Any]:
    if OLLAMA_TIMEOUT < 10:
        raise ValueError("OLLAMA_TIMEOUT –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å >= 10 —Å–µ–∫—É–Ω–¥")
    if not OLLAMA_BASE_URL.startswith(("http://", "https://")):
        raise ValueError("OLLAMA_BASE_URL –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å http:// –∏–ª–∏ https://")
    return {
        "base_url": OLLAMA_BASE_URL,
        "timeout": OLLAMA_TIMEOUT,
        "model": AI_MODEL_NAME,
        "max_retries": MAX_RETRIES
    }

SYSTEM_PROMPT = """–¢—ã –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ü–µ–ª–µ–π. –†–∞–∑–±–µ–π —Ü–µ–ª—å –Ω–∞ 3-4 —ç—Ç–∞–ø–∞. –û–¢–í–ï–¢–¨ –¢–û–õ–¨–ö–û –≠–¢–û–¢ JSON:

{
  "title": "–¶–µ–ª—å —Å–æ —Å—Ä–æ–∫–æ–º",
  "steps": [
    {
      "title": "–£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —ç—Ç–∞–ø–∞",
      "duration": "2-3 –Ω–µ–¥–µ–ª–∏",
      "actions": ["–î–µ–π—Å—Ç–≤–∏–µ 1: –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ—Å—É—Ä—Å + –º–∏–Ω—É—Ç—ã (40 –º–∏–Ω/–¥–µ–Ω—å)", "–î–µ–π—Å—Ç–≤–∏–µ 2: –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ—Å—É—Ä—Å + –º–∏–Ω—É—Ç—ã (20 –º–∏–Ω/–¥–µ–Ω—å)"],
      "resources": ["–¢–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞ 1", "–¢–æ—á–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞ 2"],
      "success": "–¶–∏—Ñ—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (20 —Ä–∏—Å—É–Ω–∫–æ–≤ / 50 –∑–∞–¥–∞—á / 500 —Å–ª–æ–≤)"
    }
  ]
}

–ü–†–ê–í–ò–õ–ê - –ë–ï–ó –ò–°–ö–õ–Æ–ß–ï–ù–ò–ô:
1. –ö–ê–ñ–î–û–ï –¥–µ–π—Å—Ç–≤–∏–µ = –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ä–µ—Å—É—Ä—Å + –≤—Ä–µ–º—è. –ü—Ä–∏–º–µ—Ä: "–°–º–æ—Ç—Ä–µ—Ç—å Draw a Box —É—Ä–æ–∫ 1-3 40 –º–∏–Ω/–¥–µ–Ω—å", "–†–∏—Å–æ–≤–∞—Ç—å —Å–∫–µ—Ç—á–∏ –Ω–∞ –±—É–º–∞–≥–µ 20 –º–∏–Ω/–¥–µ–Ω—å"
2. –°–£–ú–ú–ê –≤—Ä–µ–º–µ–Ω–∏ –≤ actions ‚â§ 60 –º–∏–Ω. –°—á–∏—Ç–∞–π: 40+20=60 ‚úÖ. 45+30=75 ‚ùå
3. –ù–û–õ–¨ –ü–û–í–¢–û–†–ï–ù–ò–ô —Ä–µ—Å—É—Ä—Å–æ–≤ –º–µ–∂–¥—É —ç—Ç–∞–ø–∞–º–∏. –≠—Ç–∞–ø 1 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Draw a Box, –≠—Ç–∞–ø 2 –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Draw a Box.
4. –£–°–ü–ï–• = —Ü–∏—Ñ—Ä–∞ –∏–ª–∏ —á–µ—Ç–∫–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç. ‚úÖ "20 —Ä–∏—Å—É–Ω–∫–æ–≤", "100 –æ—Ç–∂–∏–º–∞–Ω–∏–π", "500 —Å–ª–æ–≤". ‚ùå "—É–ª—É—á—à–∏—Ç—Å—è", "—Ö–æ—Ä–æ—à–æ —Ä–∏—Å—É–µ—Ç"
5. –≠—Ç–∞–ø—ã –ª–æ–≥–∏—á–µ—Å–∫–∏ —Ä–∞–∑–Ω—ã–µ: –≠—Ç–∞–ø 1 ‚â† –≠—Ç–∞–ø 2 ‚â† –≠—Ç–∞–ø 3. –†–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∏ –º–µ—Ç–æ–¥—ã.
6. –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã –¥–ª—è —Ü–µ–ª–∏. ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π: AthleanX (—Å–ø–æ—Ä—Ç) –¥–ª—è —Ä–∏—Å–æ–≤–∞–Ω–∏—è, freeCodeCamp (–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ) –¥–ª—è —è–∑—ã–∫–æ–≤.

–ü–†–ò–ú–ï–†–´ –î–õ–Ø –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø:
üé® –†–∏—Å–æ–≤–∞–Ω–∏–µ: Draw a Box, Proko, ArtStation, Pinterest, Clip Studio Paint, Procreate, YouTube –∫–∞–Ω–∞–ª—ã (Sinix Design, Istebrak)
üíª –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ: LeetCode, HackerRank, GitHub, Codewars, YouTube (ThePrimeagen, Fireship)
üìö –Ø–∑—ã–∫–∏: Duolingo, LingQ, BBC Learning English, Tandem, TED Talks, –ø–æ–¥–∫–∞—Å—Ç—ã, –Ω–æ–≤–æ—Å—Ç–Ω—ã–µ —Å–∞–π—Ç—ã
üèãÔ∏è –°–ø–æ—Ä—Ç: Fitbod, Nike Training Club, YouTube (Jeff Nippard, AthleanX), –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–∞–ª–æ—Ä–∏–π MyFitnessPal
üéì –û–±—É—á–µ–Ω–∏–µ: Coursera, Khan Academy, YouTube (3Blue1Brown, Crash Course, Vsauce)

–ü–†–ò–ú–ï–†–´ –ü–†–ê–í–ò–õ–¨–ù–´–• –î–ï–ô–°–¢–í–ò–ô:
‚úÖ "–°–º–æ—Ç—Ä–µ—Ç—å Draw a Box —É—Ä–æ–∫ 1-2 –≤ YouTube 35 –º–∏–Ω/–¥–µ–Ω—å"
‚úÖ "–†–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏ –Ω–∞ LeetCode Easy —É—Ä–æ–≤–Ω—è 45 –º–∏–Ω/–¥–µ–Ω—å"
‚úÖ "–°–º–æ—Ç—Ä–µ—Ç—å –≤–∏–¥–µ–æ BBC Learning English 30 –º–∏–Ω/–¥–µ–Ω—å"
‚úÖ "–ó–∞–Ω–∏–º–∞—Ç—å—Å—è –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–µ Fitbod 40 –º–∏–Ω/–¥–µ–Ω—å"

–ü–†–ò–ú–ï–†–´ –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–• –î–ï–ô–°–¢–í–ò–ô:
‚ùå "–°–º–æ—Ç—Ä–µ—Ç—å —É—Ä–æ–∫–∏" - –∫–∞–∫–∏–µ —É—Ä–æ–∫–∏? –ì–¥–µ?
‚ùå "–ü—Ä–∞–∫—Ç–∏–∫–æ–≤–∞—Ç—å —Ä–∏—Å–æ–≤–∞–Ω–∏–µ" - –∫–∞–∫? –ù–∞ —á–µ–º? S–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç?
‚ùå "–†–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ –Ω–∞–≤—ã–∫–∞–º–∏" - –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ, –Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ
‚ùå "–£—á–∏—Ç—å—Å—è" - –Ω–∞ –∫–∞–∫–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ? –°–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç?

–ì–õ–ê–í–ù–û–ï: –ú–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π, —Ç–æ—á–Ω–æ–π, —Å —Ü–∏—Ñ—Ä–∞–º–∏ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.
–ë–ï–ó –¢–ï–ö–°–¢–ê –î–û/–ü–û–°–õ–ï JSON. –¢–û–õ–¨–ö–û JSON."""

GENERATION_CONFIG = {
    "temperature": 0.1,
    "num_predict": 1000,  
    "repeat_penalty": 1.2,
}